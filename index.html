<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coronavirus map</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.css' rel='stylesheet' /></head>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
    

<body>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.js'></script>

    <div id='map' style='width: 95vw; height: 95vh;'></div>
    
    <script>
        const mapBoxToken = "pk.eyJ1Ijoic3VtdWtoYmhhdDI3MDEiLCJhIjoiY2tjZzBudmRsMG5mczJ6cGJuc2x0djZ1YiJ9.frAyxp4i4qiCypxWmYOANQ"
        mapboxgl.accessToken = mapBoxToken;

        var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v10',
        zoom:1.5,
        center:[0,20]
        }); 

        let latitude;
        let longitude;
        let country;
        let confirmedCases;
        let deadCases;
        let recoveredCases;
        let lastUpdate;
        let activeCases;
        
        function getActiveCases(data,index){
            if(data[index].recovered!=0 || recoveredCases!=null)
            return (data[index].confirmed-data[index].dead-data[index].recovered)
            else{
                return '  -'
            }
        }

        function getColor(data,activeCases){
            if(activeCases < 100)
            {    return "green";    }
            else if((activeCases >= 100)&&(activeCases < 10000))
            {   return "#BDC9E1";  }
            else{
                return "red";
            }
        }

   
        function countryData(){
            fetch("https://www.trackcorona.live/api/countries").then(response => response.json()).then(fjson => {
                const data = fjson.data
                
                mapboxgl.accessToken = mapBoxToken;
                let latitude;
                let longitude;
                let country;
                let confirmedCases;
                let deadCases;
                let recoveredCases;
                let lastUpdate;
                let activeCases;
                
                for(let i=0;i<Object.keys(data).length;i++){

                    latitude=data[i].latitude;
                    longitude=data[i].longitude;
                    country=data[i].location;
                    confirmedCases=data[i].confirmed.toString();
                    deadCases=data[i].dead.toString();
                    recoveredCases=data[i].recovered.toString();
                    if(recoveredCases=='0'){
                            recoveredCases='  -'
                    }
                    lastUpdate=data[i].updated.toString();
                    activeCases=getActiveCases(data,i);

                    //console.log(latitude,longitude,country,confirmedCases,deadCases,recoveredCases,lastUpdate)

                    var popup = new mapboxgl.Popup({ offset: 25 }).setHTML(
                        "<strong><em><h2>"+country+"</h2></em></strong><br><strong>Confirmed :</strong>"+confirmedCases+"<br><strong style='color:red'>Death :    </strong>"+deadCases+"<br><strong style='color:green'>Recovered :</strong>"+recoveredCases+"<br><strong>Active    :</strong>"+activeCases+"<br><strong>Last Update:</strong>"+lastUpdate
                    );
                    
                    var marker = new mapboxgl.Marker({
                        color: "#BDC9E1",
                        scale:0.7
                    })
                    .setLngLat([ longitude,latitude])
                    .addTo(map)
                    .setPopup(popup);
                    }
                });
            }

            function stateData(){
                fetch("https://www.trackcorona.live/api/provinces").then(response => response.json()).then(fjson => {
                const data = fjson.data
                
                for(let i=0;i<Object.keys(data).length;i++){

                    latitude=data[i].latitude;
                    longitude=data[i].longitude;
                    state=data[i].location;
                    confirmedCases=data[i].confirmed.toString();
                    deadCases=data[i].dead.toString();
                    recoveredCases=data[i].recovered;
                    if(recoveredCases==0 || recoveredCases==null){
                            recoveredCases='  -'
                    }
                    else{
                        recoveredCases=data[i].recovered.toString()
                    }
                    lastUpdate=data[i].updated.toString();
                    activeCases=getActiveCases(data,i);

                    var popup = new mapboxgl.Popup({ offset: 25 }).setHTML(
                        "<strong><em><h2>"+state+"</h2></em></strong><br><strong>Confirmed :</strong>"+confirmedCases+"<br><strong style='color:red'>Death :    </strong>"+deadCases+"<br><strong style='color:green'>Recovered :</strong>"+recoveredCases+"<br><strong>Active    :</strong>"+activeCases+"<br><strong>Last Update:</strong>"+lastUpdate.split(' ')[1]
                    );
                    
                    var marker = new mapboxgl.Marker({
                        color: getColor(data,activeCases),
                        scale:0.2
                    })
                    .setLngLat([ longitude,latitude])
                    .addTo(map)
                    .setPopup(popup);
                    }
                });
            }

            function cityData(){
                fetch("https://www.trackcorona.live/api/cities").then(response => response.json()).then(fjson => {
                const data = fjson.data
                
                for(let i=0;i<Object.keys(data).length;i++){

                    latitude=data[i].latitude;
                    longitude=data[i].longitude;
                    city=data[i].location;
                    confirmedCases=data[i].confirmed.toString();
                    deadCases=data[i].dead;
                    if(deadCases==0 || deadCases==null){
                            deadCases='  -';
                    }
                    else{
                            deadCases=data[i].dead.toString();
                    }
                    recoveredCases=data[i].recovered;
                    if(recoveredCases==0 || recoveredCases==null){
                            recoveredCases='  -';
                    }
                    else{
                        recoveredCases=data[i].recovered.toString();
                    }
                    lastUpdate=data[i].updated.toString();
                    activeCases=getActiveCases(data,i);

                    var popup = new mapboxgl.Popup({ offset: 25 }).setHTML(
                        "<strong><em><h2>"+city+"</h2></em></strong><br><strong>Confirmed :</strong>"+confirmedCases+"<br><strong style='color:red'>Death :    </strong>"+deadCases+"<br><strong style='color:green'>Recovered :</strong>"+recoveredCases+"<br><strong>Active    :</strong>"+activeCases+"<br><strong>Last Update:</strong>"+lastUpdate.split(' ')[1]
                    );
                    
                    var marker = new mapboxgl.Marker({
                        color: getColor(data,activeCases),
                        scale:0.5
                    })
                    .setLngLat([ longitude,latitude])
                    .addTo(map)
                    .setPopup(popup);
                    }
                });
            }
            
            countryData();
            //stateData();
            //cityData();

    </script>

</body>
</html>